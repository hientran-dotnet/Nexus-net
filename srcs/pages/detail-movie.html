<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - CinemaFlex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="../index.html" class="flex items-center">
                    <i class="fas fa-film text-3xl text-purple-600 mr-2"></i>
                    <span class="text-2xl font-bold text-gray-800">CinemaFlex</span>
                </a>
                <div class="flex items-center space-x-4">
                    <div id="userProfile" class="hidden flex items-center space-x-2">
                        <i class="fas fa-user-circle text-2xl text-gray-600"></i>
                        <span id="userName" class="text-gray-700 font-medium"></span>
                        <button id="logoutBtn" class="text-red-600 hover:text-red-800 ml-2">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading State -->
    <div id="loadingState" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
            <span class="ml-3 text-lg text-gray-600">Đang tải thông tin phim...</span>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <div class="text-center">
            <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Có lỗi xảy ra</h2>
            <p id="errorMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition">
                Quay lại trang chủ
            </a>
        </div>
    </div>

    <!-- Movie Detail Content -->
    <div id="movieContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <a href="../index.html" class="text-purple-600 hover:text-purple-800 mb-6 flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Quay lại danh sách phim
        </a>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Poster -->
            <div class="flex justify-center">
                <img id="detailPoster" class="w-full max-w-md rounded-lg shadow-lg" alt="Movie Poster">
            </div>
            
            <!-- Movie Info -->
            <div class="space-y-6">
                <h1 id="detailTitle" class="text-4xl font-bold text-gray-800"></h1>
                
                <!-- Movie Details Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <span class="font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-tags text-blue-500 mr-2"></i>Thể loại:
                        </span>
                        <p id="detailGenre" class="text-gray-600 mt-1"></p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <span class="font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-clock text-green-500 mr-2"></i>Thời lượng:
                        </span>
                        <p id="detailDuration" class="text-gray-600 mt-1"></p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <span class="font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-star text-yellow-500 mr-2"></i>Đánh giá:
                        </span>
                        <p id="detailRating" class="text-gray-600 mt-1"></p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <span class="font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-calendar text-purple-500 mr-2"></i>Ngày phát hành:
                        </span>
                        <p id="detailReleaseDate" class="text-gray-600 mt-1"></p>
                    </div>
                </div>
                
                <!-- Description -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold text-gray-700 text-lg mb-3 flex items-center">
                        <i class="fas fa-align-left text-indigo-500 mr-2"></i>Mô tả phim
                    </h3>
                    <p id="detailDescription" class="text-gray-600 leading-relaxed"></p>
                </div>
                
                <!-- Action Button -->
                <button id="bookTicketBtn" class="w-full bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-ticket-alt mr-2"></i>Đặt vé xem phim
                </button>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script>
        // API URL
        const API_BASE_URL = 'https://itdi.io.vn/services/movies';
        
        // Get movie ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        
        // Elements
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const movieContent = document.getElementById('movieContent');
        const errorMessage = document.getElementById('errorMessage');
        
        // Load movie details
        async function loadMovieDetail() {
            if (!movieId) {
                showError('ID phim không hợp lệ!');
                return;
            }
            
            try {
                showLoading();
                
                const response = await fetch(`${API_BASE_URL}/get-movie-by-id.php?id=${movieId}`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'Không thể lấy thông tin phim!');
                }
                
                displayMovieDetail(result.data);
                showContent();
                
            } catch (error) {
                console.error('Error loading movie detail:', error);
                showError(error.message || 'Có lỗi xảy ra khi tải thông tin phim!');
            }
        }
        
        // Display movie details
        function displayMovieDetail(movie) {
            document.getElementById('detailTitle').textContent = movie.title || 'Không có tiêu đề';
            document.getElementById('detailPoster').src = movie.poster_url || 'https://via.placeholder.com/400x600?text=No+Image';
            document.getElementById('detailDescription').textContent = movie.description || 'Không có mô tả';
            document.getElementById('detailGenre').textContent = movie.genre || 'Không rõ';
            document.getElementById('detailDuration').textContent = movie.duration || 'Không rõ';
            document.getElementById('detailRating').textContent = movie.rating || 'Chưa có đánh giá';
            document.getElementById('detailReleaseDate').textContent = movie.release_date || 'Không rõ';
            
            // Update page title
            document.title = `${movie.title} - CinemaFlex`;
            
            // Book ticket button
            document.getElementById('bookTicketBtn').onclick = function() {
                // Check if user is logged in (if you have auth system)
                // if (!isLoggedIn()) {
                //     alert('Vui lòng đăng nhập để đặt vé!');
                //     window.location.href = 'login.html';
                //     return;
                // }
                
                // Redirect to booking page
                window.location.href = `booking.html?id=${movieId}`;
            };
        }
        
        // Show loading state
        function showLoading() {
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            movieContent.classList.add('hidden');
        }
        
        // Show error state
        function showError(message) {
            errorMessage.textContent = message;
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            movieContent.classList.add('hidden');
        }
        
        // Show content
        function showContent() {
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            movieContent.classList.remove('hidden');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadMovieDetail();
            // updateUserInterface(); // If you have auth system
        });
    </script>
</body>
</html>